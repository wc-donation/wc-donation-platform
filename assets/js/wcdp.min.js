jQuery(function(r){if(r(document).on("change",'#wcdp_fee_recovery, input[name="payment_method"]',function(){(r(this).is("#wcdp_fee_recovery")||r("#wcdp_fee_recovery").prop("checked"))&&setTimeout(()=>r("body").trigger("update_checkout"),400)}),document.querySelector(".wcdp-form")){let a,e=(r("#wcdp-ajax-send")?.on("submit",function(e){e.preventDefault();e=r("#wcdp-ajax-send").serialize();(a!=e?(a=e,d):l)(2)}),0),c=(r(".wcdp-body > #wcdp-ajax-send")?.on("input blur keyup paste change",function(){a!=r("#wcdp-ajax-send").serialize()&&(e++,a=r("#wcdp-ajax-send").serialize(),setTimeout(function(){0===--e&&d()},1300))}),0),o=0,n=(r(".wcdp-body")?.on("input blur keyup paste change load",function(){let e=document.querySelector(".wcdp-body .single_add_to_cart_button");var t=document.querySelector("#wcdp-get-send");e&&t&&t.checkValidity()?e.classList.remove("disabled"):e&&e.classList.add("disabled"),r(".wcdp-express-amount").val(r('input[name="wcdp-donation-amount"]').val()),c++,setTimeout(function(){0==--c&&o!=r('input[name="wcdp-donation-amount"]').val()&&(o=r('input[name="wcdp-donation-amount"]').val(),r(document.body).trigger("woocommerce_variation_has_changed"),e)&&e.classList.toggle("wcdp_price_changed")},500)}),1),t=(r(".wcdp-form .wcdp-button, .wcdp-step").click(function(){var e,t=r(this).attr("data-step");1!=n?l(t):1!==t&&s("#wcdp-ajax-send")&&(e=r("#wcdp-ajax-send").serialize(),(a!=e?(a=e,d):l)(t))}),10);r(document).ready(function(){r(".wcdp-loader")?.hide(),r(".wc-donation-platform")?.css({visibility:"visible","animation-name":"wcdp-appear-animation","animation-duration":"1s"}),h(!1);try{0!=r('input[name="wcdp-donation-amount"]')?.val()&&r("#wcdp-ajax-send")?.trigger("change"),r(".wcdp-choose-donation")[0].checkValidity()&&(a=r("#wcdp-ajax-send")?.serialize(),d()),r("form.woocommerce-checkout select")?.selectWoo()}finally{r("#wcdp-ajax-send,.wcdp_options")?.trigger("change"),setTimeout(u,t)}}),window.onhashchange=function(){h(!1)},r(".wcdp-modal-open")?.click(function(){h(!0)}),r(document).on("keypress","input",function(e){"Escape"===e.key&&w()}),r(".wcdp-modal-close")?.click(w);var i=!1;function d(t){var e,a;s("#wcdp-ajax-send")&&(r("#wcdp-spinner").show(),r("#wcdp-ajax-button").hide(),a=(e=r("#wcdp-ajax-send")).serialize(),r.ajax({type:"POST",url:e.attr("action"),data:a}).done(function(e){!0===e.success?(r(".woocommerce-error").remove(),r("body").trigger("update_checkout"),r("#wcdp-ajax-button").show(),r("#wcdp-spinner").hide(),e.recurring?(r("#createaccount").prop("checked",!0).trigger("change"),r(".create-account:has(#createaccount)").hide()):r(".create-account:has(#createaccount)").show(),l(t)):p(e.message,e.reload,e.newParams)}).fail(function(){r("#wcdp-spinner").hide(),p(r(".wcdp-choose-donation").attr("wcdp-error-default"))}))}function s(e){var t=r("#variation_id");try{return r(e)[0].reportValidity()&&(0===t.length||""!=t.attr("value"))}catch(e){}}function p(e="An unexpected error occurred. Please reload the page and try again. If the problem persists, please contact our support team.",t=!0,c=!1){if(t||r("#wcdp-ajax-button").show(),c){alert(e);let a=new URL(window.location.href);Object.entries(c).forEach(([e,t])=>a.searchParams.set(e,t)),window.location.href=a.toString()}r("#wcdp-spinner").hide(),r("#wcdp-ajax-error").remove(),r("form.checkout.woocommerce-checkout").prepend('<ul class="woocommerce-error" id="wcdp-ajax-error" role="alert"><li></li></ul>'),r("#wcdp-ajax-error li").text(e)}function l(e){var t=r(":root")[0];switch(t.style.setProperty("--wcdp-step-2","var(--wcdp-main)"),t.style.setProperty("--wcdp-step-3","var(--wcdp-main)"),e){case"3":r("#wcdp-step-2").show(),r("form.checkout").find(".input-text:visible, select:visible, input:checkbox:visible").trigger("validate"),0<r("#wcdp-step-2 .woocommerce-invalid:visible").length?(r("#wcdp-invalid-fields").show(),r("#place_order").hide()):(r("#wcdp-invalid-fields").hide(),r("#place_order").show()),t.style.setProperty("--wcdp-step-3","var(--wcdp-main-2)");case"2":t.style.setProperty("--wcdp-step-2","var(--wcdp-main-2)");break;case"1":break;default:return}r(".wcdp-style5-active")?.removeClass("wcdp-style5-active"),r("#wcdp-style5-step-"+e)?.addClass("wcdp-style5-active"),r("#wcdp-progress-bar")?.css("width",33.33*(parseInt(e)-1)+"%"),r(".wcdp-tab")?.hide(),r("#wcdp-step-"+e)?.show(),n=e}function u(){0<r("#wc-stripe-payment-request-button")?.children()?.length+r("#ppc-button, #ppc-button-ppcp-gateway")?.children()?.length?r(".wcdp-express-heading")?.show():t<1e4&&(t*=2,setTimeout(u,t))}function w(){i&&(r(".wcdp-overlay")?.hide(),r("body")?.css("overflow-y"," auto"),history.pushState("",document.title,window.location.pathname+window.location.search),i=!1)}function h(e){var t=r(".wcdp-overlay");(e||"#wcdp-form"===location.hash&&0<t.length)&&(t.show(),r("body")?.css("overflow-y","hidden"),i=!0)}function m(){this.querySelectorAll(".wcdp_su input").forEach(e=>{var t=this.querySelector(`select option[value="${e.value}"]`);t&&t.classList.contains("attached")&&(t.classList.contains("enabled")?e.removeAttribute("disabled"):e.setAttribute("disabled","true"),e.checked)&&t&&(t.parentElement.value=e.value,r(t.parentElement).trigger("change"))});var e=this.querySelector(".wcdp_amount_suggestion:checked"),t=this.querySelector('input[name="wcdp-donation-amount"]'),a=this.querySelector('input[name="attribute_wcdp_donation_amount"]');e&&t&&(t.value=e.value),a&&t&&(a.value=t.value)}r(document).on("input",".wcdp-range",function(){var e=r(this),t=e.closest("form").data("formid"),t=r(`form[data-formid="${t}"] .wcdp_donation_amount_field`);t.length&&(t.val(e.val()),e.val()==e.attr("max"))&&t.select()}),r(".wcdp-amount-range-field")?.on("input",function(){r("#wcdp-range")?.val(r('input[name="wcdp-donation-amount"]')?.val())}),document.querySelectorAll(".wcdp_value_other").forEach(e=>{e.addEventListener("click",()=>{e.parentElement?.querySelector(".wcdp-input-field")?.focus()})}),document.querySelectorAll("form.wcdp-choose-donation").forEach(e=>{e.addEventListener("change",m)}),wp.hooks.addFilter("wcstripe.express-checkout.map-line-items","wc-donation-platform/modify-cart-data",function(e){return e.items.forEach(e=>{e.label=e.name}),console.log(e),e})}});
