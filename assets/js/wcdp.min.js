jQuery(function(i){if(i(document).on("change",'#wcdp_fee_recovery, input[name="payment_method"]',function(){(i(this).is("#wcdp_fee_recovery")||i("#wcdp_fee_recovery").prop("checked"))&&setTimeout(()=>i("body").trigger("update_checkout"),400)}),document.querySelector(".wcdp-form")){let c,e=(i("#wcdp-ajax-send")?.on("submit",function(e){e.preventDefault();e=i("#wcdp-ajax-send").serialize();(c!=e?(c=e,d):u)(2)}),0),o=(i(".wcdp-body > #wcdp-ajax-send")?.on("input blur keyup paste change",function(){c!=i("#wcdp-ajax-send").serialize()&&(e++,c=i("#wcdp-ajax-send").serialize(),setTimeout(function(){0===--e&&d()},1300))}),0),n=0,r=(i(".wcdp-body")?.on("input blur keyup paste change load",function(){let e=document.querySelector(".wcdp-body .single_add_to_cart_button");var t=document.querySelector("#wcdp-get-send");e&&t&&t.checkValidity()?e.classList.remove("disabled"):e&&e.classList.add("disabled"),i(".wcdp-express-amount").val(i('input[name="wcdp-donation-amount"]').val()),o++,setTimeout(function(){0==--o&&n!=i('input[name="wcdp-donation-amount"]').val()&&(n=i('input[name="wcdp-donation-amount"]').val(),i(document.body).trigger("woocommerce_variation_has_changed"),e)&&e.classList.toggle("wcdp_price_changed")},500)}),1),t=(i(".wcdp-form .wcdp-button, .wcdp-step").click(function(t){var o,n=parseInt(i(this).attr("data-step"));if(r!==n){let e=n;if(1===r&&3===n&&(e=2),1===r){if(!s("#wcdp-ajax-send"))return;n=i("#wcdp-ajax-send").serialize();if(c!=n)return c=n,void d(e)}if(2===r&&3===e){i("#wcdp-step-2 .validate-required").find("input:visible, select:visible").trigger("validate");n=i("#wcdp-step-2 .woocommerce-invalid:visible");if(0<n.length){n=n.first();a=n,(o=i("#wcdp-step-2 .wcdp-required-field-notice")).length&&a&&a.length&&(o.attr("role","alert"),o.attr("aria-live","polite"),a.append(o)),l(n[0],200,!0);try{n.find("input,select,textarea,button").first().focus()}catch(t){}var a=document.querySelector("form.checkout");return void(a&&"function"==typeof a.reportValidity&&a.reportValidity())}}u(e)}}),10);i(document).ready(function(){i(".wcdp-loader")?.hide(),i(".wc-donation-platform")?.css({visibility:"visible","animation-name":"wcdp-appear-animation","animation-duration":"1s"}),h(!1);try{0!=i('input[name="wcdp-donation-amount"]')?.val()&&i("#wcdp-ajax-send")?.trigger("change"),i(".wcdp-choose-donation")[0].checkValidity()&&(c=i("#wcdp-ajax-send")?.serialize(),d()),i("form.woocommerce-checkout select")?.selectWoo()}finally{i("#wcdp-ajax-send,.wcdp_options")?.trigger("change"),setTimeout(w,t)}}),window.onhashchange=function(){h(!1)},i(".wcdp-modal-open")?.click(function(){h(!0)}),i(document).on("keypress","input",function(e){"Escape"===e.key&&m()}),i(".wcdp-modal-close")?.click(m);var a=!1;function d(t){var e,o;s("#wcdp-ajax-send")&&(i("#wcdp-spinner").show(),i("#wcdp-ajax-button").hide(),o=(e=i("#wcdp-ajax-send")).serialize(),i.ajax({type:"POST",url:e.attr("action"),data:o}).done(function(e){!0===e.success?(i(".woocommerce-error").remove(),i("body").trigger("update_checkout"),i("#wcdp-ajax-button").show(),i("#wcdp-spinner").hide(),e.recurring?(i("#createaccount").prop("checked",!0).trigger("change"),i(".create-account:has(#createaccount)").hide()):i(".create-account:has(#createaccount)").show(),u(t)):p(e.message,e.reload,e.newParams)}).fail(function(){i("#wcdp-spinner").hide(),p(i(".wcdp-choose-donation").attr("wcdp-error-default"))}))}function s(e){var t=i("#variation_id");try{return i(e)[0].reportValidity()&&(0===t.length||""!=t.attr("value"))}catch(e){}}function l(e,t=200,o=!0){if(e)try{var n,a,c=e.getBoundingClientRect(),r=c.top+window.pageYOffset-t,i=(r<0&&(r=0),(e=>{for(var t=e;t&&t!==document.body&&t!==document.documentElement;){var o=window.getComputedStyle(t);if(/(auto|scroll)/.test(o.overflow+o.overflowY+o.overflowX))return t;t=t.parentElement}return document.scrollingElement||document.documentElement||window})(e)),d=o?"smooth":"auto";i===document.scrollingElement||i===document.documentElement||i===window?window.scrollTo({top:r,behavior:d}):(n=i.getBoundingClientRect(),(a=i.scrollTop+(c.top-n.top)-t)<0&&(a=0),i.scrollTo({top:a,behavior:d}))}catch(e){}}function p(e="An unexpected error occurred. Please reload the page and try again. If the problem persists, please contact our support team.",t=!0,n=!1){if(t||i("#wcdp-ajax-button").show(),n){alert(e);let o=new URL(window.location.href);Object.entries(n).forEach(([e,t])=>o.searchParams.set(e,t)),window.location.href=o.toString()}i("#wcdp-spinner").hide(),i("#wcdp-ajax-error").remove(),i("form.checkout.woocommerce-checkout").prepend('<ul class="woocommerce-error" id="wcdp-ajax-error" role="alert"><li></li></ul>'),i("#wcdp-ajax-error li").text(e)}function u(e){var t=document.documentElement;switch(t.style.setProperty("--wcdp-step-2","var(--wcdp-main)"),t.style.setProperty("--wcdp-step-3","var(--wcdp-main)"),e){case 3:t.style.setProperty("--wcdp-step-3","var(--wcdp-main-2)");case 2:t.style.setProperty("--wcdp-step-2","var(--wcdp-main-2)");break;case 1:break;default:return}i(".wcdp-style5-active")?.removeClass("wcdp-style5-active"),i("#wcdp-style5-step-"+e)?.addClass("wcdp-style5-active"),i("#wcdp-progress-bar")?.css("width",33.33*(parseInt(e)-1)+"%");var o=document.getElementById("wcdp-step-"+e);o&&(i(".wcdp-tab")?.hide(),o.style.display="block",l(o,200,!0),o.querySelector('input:not([disabled]):not([type="hidden"]), button:not([disabled]), select, textarea, [tabindex]:not([tabindex="-1"])')?.focus(),r=e)}function w(){0<i("#wc-stripe-payment-request-button")?.children()?.length+i("#ppc-button, #ppc-button-ppcp-gateway")?.children()?.length?i(".wcdp-express-heading")?.show():t<1e4&&(t*=2,setTimeout(w,t))}function m(){a&&(i(".wcdp-overlay")?.hide(),i("body")?.css("overflow-y"," auto"),history.pushState("",document.title,window.location.pathname+window.location.search),a=!1)}function h(e){var t=i(".wcdp-overlay");(e||"#wcdp-form"===location.hash&&0<t.length)&&(t.show(),i("body")?.css("overflow-y","hidden"),a=!0)}function f(){this.querySelectorAll(".wcdp_su input").forEach(e=>{var t=this.querySelector(`select option[value="${e.value}"]`);t&&t.classList.contains("attached")&&(t.classList.contains("enabled")?e.removeAttribute("disabled"):e.setAttribute("disabled","true"),e.checked)&&t&&(t.parentElement.value=e.value,i(t.parentElement).trigger("change"))});var e=this.querySelector(".wcdp_amount_suggestion:checked"),t=this.querySelector('input[name="wcdp-donation-amount"]'),o=this.querySelector('input[name="attribute_wcdp_donation_amount"]');e&&t&&(t.value=e.value),o&&t&&(o.value=t.value)}i(document).on("input",".wcdp-range",function(){var e=i(this),t=e.closest("form").data("formid"),t=i(`form[data-formid="${t}"] .wcdp_donation_amount_field`);t.length&&(t.val(e.val()),e.val()==e.attr("max"))&&t.select()}),i(".wcdp-amount-range-field")?.on("input",function(){i("#wcdp-range")?.val(i('input[name="wcdp-donation-amount"]')?.val())}),document.querySelectorAll(".wcdp_value_other").forEach(e=>{e.addEventListener("click",()=>{e.parentElement?.querySelector(".wcdp-input-field")?.focus()})}),document.querySelectorAll("form.wcdp-choose-donation").forEach(e=>{e.addEventListener("change",f)})}});
